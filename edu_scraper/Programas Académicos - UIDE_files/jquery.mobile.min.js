/**
 * VClick support
 */
(function(a,b,c){function d(a){for(;a&&"undefined"!=typeof a.originalEvent;)a=a.originalEvent;return a}function e(b,c){var e,f,g,h,k,l,m,n,o,p=b.type;if(b=a.Event(b),b.type=c,e=b.originalEvent,f=a.event.props,-1<p.search(/^(mouse|click)/)&&(f=C),e)for(m=f.length,h;m;)h=f[--m],b[h]=e[h];if(-1<p.search(/mouse(down|up)|click/)&&!b.which&&(b.which=1),-1!==p.search(/^touch/)&&(g=d(e),p=g.touches,k=g.changedTouches,l=p&&p.length?p[0]:k&&k.length?k[0]:void 0,l))for(n=0,o=y.length;n<o;n++)h=y[n],b[h]=l[h];return b}function f(c){for(var d,e,f={};c;){for(e in d=a.data(c,"virtualMouseBindings"),d)d[e]&&(f[e]=f.hasVirtualBinding=!0);c=c.parentNode}return f}function g(c,d){for(var e;c;){if(e=a.data(c,"virtualMouseBindings"),e&&(!d||e[d]))return c;c=c.parentNode}return null}function h(){K=!1}function j(){K=!0}function k(){O=0,I.length=0,J=!1,j()}function l(){h()}function m(){n(),E=setTimeout(function(){E=0,k()},a.vmouse.resetTimerDuration)}function n(){E&&(clearTimeout(E),E=0)}function o(b,c,d){var f;return(d&&d[b]||!d&&g(c.target,b))&&(f=e(c,b),a(c.target).trigger(f)),f}function p(b){var c,d=a.data(b.target,"virtualTouchID");J||O&&O===d||(c=o("v"+b.type,b),c&&(c.isDefaultPrevented()&&b.preventDefault(),c.isPropagationStopped()&&b.stopPropagation(),c.isImmediatePropagationStopped()&&b.stopImmediatePropagation()))}function q(b){var c,e,g,h=d(b).touches;h&&1===h.length&&(c=b.target,e=f(c),e.hasVirtualBinding&&(O=N++,a.data(c,"virtualTouchID",O),n(),l(),H=!1,g=d(b).touches[0],F=g.pageX,G=g.pageY,o("vmouseover",b,e),o("vmousedown",b,e)))}function r(a){K||(!H&&o("vmousecancel",a,f(a.target)),H=!0,m())}function s(b){if(!K){var c=d(b).touches[0],e=H,g=a.vmouse.moveDistanceThreshold,h=f(b.target);H=H||Math.abs(c.pageX-F)>g||Math.abs(c.pageY-G)>g,H&&!e&&o("vmousecancel",b,h),o("vmousemove",b,h),m()}}function t(a){if(!K){j();var b,c,e=f(a.target);o("vmouseup",a,e),H||(b=o("vclick",a,e),b&&b.isDefaultPrevented()&&(c=d(a).changedTouches[0],I.push({touchID:O,x:c.clientX,y:c.clientY}),J=!0)),o("vmouseout",a,e),H=!1,m()}}function u(b){var c,d=a.data(b,"virtualMouseBindings");if(d)for(c in d)if(d[c])return!0;return!1}function v(){}function w(b){var c=b.substr(1);return{setup:function(){u(this)||a.data(this,"virtualMouseBindings",{});var d=a.data(this,"virtualMouseBindings");d[b]=!0,D[b]=(D[b]||0)+1,1===D[b]&&M.bind(c,p),a(this).bind(c,v),L&&(D.touchstart=(D.touchstart||0)+1,1===D.touchstart&&M.bind("touchstart",q).bind("touchend",t).bind("touchmove",s).bind("scroll",r))},teardown:function(){--D[b],D[b]||M.unbind(c,p),L&&(--D.touchstart,!D.touchstart&&M.unbind("touchstart",q).unbind("touchmove",s).unbind("touchend",t).unbind("scroll",r));var d=a(this),e=a.data(this,"virtualMouseBindings");e&&(e[b]=!1),d.unbind(c,v),u(this)||d.removeData("virtualMouseBindings")}}}var z,A,x=["vmouseover","vmousedown","vmousemove","vmouseup","vclick","vmouseout","vmousecancel"],y=["clientX","clientY","pageX","pageY","screenX","screenY"],B=a.event.mouseHooks?a.event.mouseHooks.props:[],C=a.event.props.concat(B),D={},E=0,F=0,G=0,H=!1,I=[],J=!1,K=!1,L=("addEventListener"in c),M=a(c),N=1,O=0;for(a.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},A=0;A<x.length;A++)a.event.special[x[A]]=w(x[A]);L&&c.addEventListener("click",function(b){var c,d,e,f,g,h,j=I.length,k=b.target;if(j)for(c=b.clientX,d=b.clientY,z=a.vmouse.clickDistanceThreshold,e=k;e;){for(f=0;f<j;f++)if(g=I[f],h=0,e===k&&Math.abs(g.x-c)<z&&Math.abs(g.y-d)<z||a.data(e,"virtualTouchID")===g.touchID)return b.preventDefault(),void b.stopPropagation();e=e.parentNode}},!0)})(jQuery,window,document);