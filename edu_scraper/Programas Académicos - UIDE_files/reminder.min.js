(function(c){const e=(new window.StecHelper).lang;window.StecReminder=function(a){this.settings={popup:"#"+a,id:null,offset:null,$event:null,glob:null,helper:null,calData:null,$instance:null,instance:null,displayPrivacyAgreement:0,privacyAgreemntContent:""};this.blockAction=!1};var d=window.StecReminder.prototype;d.set=function(a,b){"undefined"!==typeof this.settings[a]&&(this.settings[a]=b);return this};d.controller=function(){var a=this;c(document).on(this.settings.helper.clickHandle(),a.settings.popup+
" .stec-reminder-popup",function(a){a.stopPropagation()});c(document).on(this.settings.helper.clickHandle(),a.settings.popup+" .stec-reminder-popup-button-cancel",function(b){b.stopPropagation();a.popClose()});c(document).on(this.settings.helper.clickHandle(),a.settings.popup+" .stec-reminder-popup-button-close",function(){a.popClose()});c(document).on(this.settings.helper.clickHandle(),a.settings.popup,function(){a.popClose()});this.settings.$instance.on(this.settings.helper.clickHandle(),".stec-layout-event-preview-right-menu, .stec-layout-event-preview-left-reminder-toggle",
function(b){b.stopPropagation();b=c(this).parents(".stec-layout-event").first();a.settings.id=parseInt(b.attr("data-id"),10);a.settings.offset=parseInt(b.attr("data-repeat-time-offset"),10);a.popOpen()});this.settings.$instance.on(this.settings.helper.clickHandle(),".stec-layout-single-preview-right-menu, .stec-layout-single-preview-left-reminder-toggle",function(b){b.stopPropagation();a.settings.id=parseInt(a.settings.glob.event.id,10);a.settings.offset=parseInt(a.settings.glob.options.repeat_offset,
10);a.popOpen()});c(document).on(this.settings.helper.clickHandle(),a.settings.popup+" .stec-reminder-popup-button-proceed",function(b){b.stopPropagation();!1!==a.popFieldsValid()&&(1===parseInt(a.settings.glob.options.captcha.enabled,10)&&a.settings.glob.options.captcha.site_key?(a.popCaptcha.sitekey||(a.popCaptcha.sitekey=a.settings.glob.options.captcha.site_key),0>=c(".stec-reminder-popup-wrapper-captcha-placeholder").children().length?a.popCaptcha.open(function(){!1!==a.popFieldsValid()&&!1!==
a.popCaptcha.captchaValid&&a.sendRemind()}):!0===a.popCaptcha.captchaValid&&a.sendRemind()):(a.popCaptcha.captchaValid=!0,a.sendRemind()))})};d.sendRemind=function(){var a=this;if(!0!==a.blockAction){var b=new window.StecDB;var e=b.newRequest();var d=parseInt(c(a.settings.popup).find('.stec-reminder-popup-wrapper-settings select[name="units"]').val(),10);var g=parseInt(c(a.settings.popup).find('.stec-reminder-popup-wrapper-settings input[name="number"]').val(),10);var f=0;switch(d){case 1:d=3600;
break;case 2:d=86400;break;case 3:d=604800}f=Math.max(3600,d*g);e.setBefore(function(){a.blockAction=!0});e.setData({action:"stec_public_ajax_action",task:"add_reminder",event_id:a.settings.id,repeat_offset:a.settings.offset,before:f,email:c(a.settings.popup).find('.stec-reminder-popup-wrapper-settings input[name="email"]').val().trim()});e.setCallback(function(b){c(a.settings.popup).find(".stec-reminder-popup-wrapper-settings").hide();c(a.settings.popup).find(".stec-reminder-popup-wrapper-captcha").hide();
c(a.settings.popup).find(".stec-reminder-popup-wrapper-status span").text(b.msg);c(a.settings.popup).find(".stec-reminder-popup-wrapper-status").show();c(a.settings.popup).find(".stec-reminder-popup-button-cancel").hide();c(a.settings.popup).find(".stec-reminder-popup-button-proceed").hide();c(a.settings.popup).find(".stec-reminder-popup-button-close").show();a.blockAction=!1});b.query(e)}};d.popFieldsValid=function(){var a=!0;""===c('.stec-reminder-popup-wrapper-settings input[name="email"]').val().trim()&&
(a=!1);""===c('.stec-reminder-popup-wrapper-settings input[type="number"]').val().trim()&&(a=!1);c(".stec-reminder-popup-wrapper-settings input,select").filter("[required]:visible").each(function(){if(c(this).is(":checkbox")&&!1===c(this).prop("checked")||""===c(this).val().trim())return a=!1});return a};d.popHtml=function(){var a="",b=[],c="",d=this.settings.calData?this.settings.calData.getEventById(this.settings.id):this.settings.glob.event;0<d.images_meta.length&&(a=d.images_meta[0].src);this.settings.glob.options.useremail&&
(c=this.settings.glob.options.useremail);b.push('<div id="'+this.settings.popup.replace("#","")+'" class="stec-reminder-popup-background stec-modal">');b.push('     <div class="stec-reminder-popup">');b.push('         <div class="stec-reminder-popup-header" style="background-image:url('+a+')"><i class="far fa-bell"></i></div>');b.push('         <div class="stec-reminder-popup-wrapper">');b.push('             <div class="stec-reminder-popup-wrapper-captcha">');b.push("                 <span>"+e("confirmhumanity")+
"</span>");b.push("                 <span>"+e("confirmhumanitydesc")+"</span>");b.push('                 <div class="stec-reminder-popup-wrapper-captcha-placeholder"></div>');b.push("             </div>");b.push('             <div class="stec-reminder-popup-wrapper-settings">');b.push("                 <span>"+e("setareminder")+"</span>");b.push('                 <input type="email" name="email" placeholder="'+e("email")+'" value="'+c+'" />');b.push('                 <div class="stec-reminder-flex">');
b.push('                     <input type="number" min="1" max="30" name="number" value="1" />');b.push('                     <select name="units">');b.push('                         <option value="1">'+e("hours")+"</option>");b.push('                         <option value="2">'+e("days")+"</option>");b.push('                         <option value="3">'+e("weeks")+"</option>");b.push("                     </select>");b.push("                     <span>"+e("beforetheevent")+"</span>");b.push("                 </div>");
"1"===this.settings.displayPrivacyAgreement&&(b.push('             <label class="stec-reminder-popup-checkbox">'),b.push('                 <input type="checkbox" required />'),b.push('                 <span class="stec-style-text">'+this.settings.privacyAgreemntContent+"</span>"),b.push("             </label>"));b.push("             </div>");b.push("         </div>");b.push('         <div class="stec-reminder-popup-wrapper-status">');b.push("             <span></span>");b.push("         </div>");
b.push('         <button class="stec-reminder-popup-button-cancel" type="button">'+e("cancel")+"</button>");b.push('         <button class="stec-reminder-popup-button-proceed" type="button">'+e("proceed")+"</button>");b.push('         <button class="stec-reminder-popup-button-close" type="button">'+e("close")+"</button>");b.push("     </div>");b.push("</div>");return b.join("")};d.popOpen=function(){c("body").addClass("stec-modal-opened");c(this.popHtml()).appendTo("body")};d.popClose=function(){this.settings.id=
null;this.settings.offset=null;this.blockAction=!1;c("body").removeClass("stec-modal-opened");c(".stec-reminder-popup-background").remove()};d.popCaptcha={sitekey:null,captchaValid:!1,open:function(a){var b=this;b.captchaValid=!1;c(".stec-reminder-popup-wrapper-settings").hide();c(".stec-reminder-popup-wrapper-captcha").show();window.grecaptcha.render(c(".stec-reminder-popup-wrapper-captcha-placeholder").get(0),{sitekey:b.sitekey,callback:function(c){0!==c.length&&(b.captchaValid=!0,"function"===
typeof a&&a())}})}}})(window.jQuery);