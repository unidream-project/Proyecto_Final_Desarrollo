(function(c){function q(){function q(b){switch(f.options.date_format){case "dd-mm-yy":var c="DD-MM-Y";break;case "mm-dd-yy":c="MM-DD-Y";break;case "yy-mm-dd":c="Y-MM-DD";break;case "dd.mm.yyyy":c="DD.MM.Y";break;default:c=f.options.date_format}return p(b).format(c)}function v(){var b=f.options.edit_event;c.each(a.find('textarea, input[type="text"], input[type="number"], input[type="email"], input[type="url"]'),function(){var a=c(this).attr("name");if(a)switch(a){case "contact_email":c(this).val(b.contact_email);
break;case "notes":c(this).val(b.review_note);break;case "start_date":a=b.start_date.split(" ");c(this).datepicker("setDate",p(a[0]).toDate());break;case "end_date":a=b.end_date.split(" ");c(this).datepicker("setDate",p(a[0]).toDate());break;case "rsvp[collect]]":break;default:b[a]&&c(this).val(b[a])}});b.link&&(a.find('input[name="link[url]"]').val(b.link.url),a.find('input[name="link[text]"]').val(b.link.text?b.link.text:""));c.each(a.find("textarea"),function(){var a=c(this).attr("name");a&&b[a]&&
c(this).html(b[a])});d.tinymce.setContent(b.description);c.each(a.find("select"),function(){var a=c(this).attr("name");if(a)switch(a){case "start_time_hours":a=b.start_date.split(" ");a=a[1].split(":");c(this).val(a[0]);break;case "end_time_hours":a=b.end_date.split(" ");a=a[1].split(":");c(this).val(a[0]);break;case "start_time_minutes":a=b.start_date.split(" ");a=a[1].split(":");c(this).val(a[1]);break;case "end_time_minutes":a=b.end_date.split(" ");a=a[1].split(":");c(this).val(a[1]);break;case "calendar_id":c(this).val(b.calid);
break;case "event_categories[]":if(b.category){var e=[];c.each(b.category,function(){e.push(this.id)});c(this).val(e)}break;case "location":b.location.id&&c(this).val(b.location.id);break;default:b[a]&&c(this).val(b[a])}});a.find('input[name="event_color"]').ColorPickerSetColor(b.color);a.find('input[name="event_color"]').val(b.color);a.find('input[name="event_color"]').css("background-color",b.color);c.each(a.find('input[type="checkbox"]'),function(){var a=c(this).attr("name");a&&b[a]&&(a=1===parseInt(b[a],
10),c(this).prop("checked")!==a&&(c(this).prop("checked",!0),c(this).trigger("change")))});if(b.rrule){var e=b.rrule;if(""===e){c('select[name="repeater"]').val(0);return}e=new window.rrule.RRule.fromString(e);c('select[name="repeater"]').val(Math.abs(4-e.origOptions.freq));if(e.origOptions.byweekday){var g="MO TU WE TH FR SA SU".split(" ");c('.stec-repeater-content-repeat-on input[type="checkbox"]').prop("checked","");c(e.origOptions.byweekday).each(function(b,a){c('.stec-repeater-content-repeat-on input[name="'+
g[a.weekday]+'"]').prop("checked","checked")})}e.origOptions.interval?c('select[name="repeat_gap"]').val(e.origOptions.interval):c('select[name="repeat_gap"]').val(0);e.origOptions.count&&(c('input[name="repeat_occurences"]').val(e.origOptions.count),c('input[name="repeat_occurences"]').parents("label").first().find('input[type="radio"]').trigger("click"));e.origOptions.until&&(c('input[name="repeat_ends_on_date"]').datepicker("setDate",e.origOptions.until),c('input[name="repeat_ends_on_date"]').parents("label").first().find('input[type="radio"]').trigger("click"));
a.find('select[name="repeater"]').trigger("change");b.exdate&&(e=b.exdate.split(","),c.each(e,function(){var b=p(this);d.repeater.addExdate(b)}))}0<b.guests.length&&c.each(b.guests,function(){d.guests.addGuest(this)});a.find('input[name="rsvp[limit]"]').val(b.rsvp_limit);a.find('select[name="rsvp[collect]"]').val(b.rsvp);a.find('select[name="rsvp[visibility]"]').val(b.attendance_visibility);0<b.attendance.length&&c.each(b.attendance,function(){d.attendance.addAttendee(this)});0<b.organizers.length&&
c.each(b.organizers,function(){a.find('select[name="organizers[]"] option[value="'+this.id+'"]').prop("selected",!0)});0<b.schedule.length&&c.each(b.schedule,function(){d.schedules.addSchedule(this)});0<b.bookable_products.length&&c.each(b.bookable_products,function(){d.booking.addTicket(this)});c('<input type="hidden" name="event_id" value="'+b.id+'" />').appendTo(a.find("form"));0<b.images.length&&c.each(b.images_meta,function(){d.media.fillImage(".stec-builder-element-content-media-images-style",
{inputName:"images[]",multiple:!0,image:{id:this.id,src:this.src}})});0<b.icon_images.length&&"image"===b.icon_type&&c.each(b.icon_images_meta,function(){d.media.fillImage(".stec-builder-element-content-media-icon-images-style",{inputName:"icon_images[]",multiple:!0,image:{id:this.id,src:this.src}})});d.iconTypes.set();0<b.attachments.length&&c.each(b.attachments,function(){d.media.fillAttachment(".stec-builder-element-content-attachments-style",{inputName:"attachments[]",multiple:!0,file:{id:this.id,
title:this.filename}})});c('<input data-action="delete-event" type="button" name="delete" value="'+k("Delete Event")+'">').appendTo(a.find(".stec-builder-element-content-submit-style"))}function w(){if(!0!==d.captcha.valid)return d.modal.open(0,k("Verify Captcha")),!1;d.repeater.setRrule();var b=new FormData(a.find("form")[0]);b.append("action","stec_public_ajax_action");b.append("description",d.tinymce.getContent());b.append("task","front_create_event");var c=m.newRequest();c.setData(b);c.setBefore(function(){a.find(".stec-builder-element-content-submit-style").hide();
d.modal.open(2,k("submittingEvent"))});c.setOnError(function(b){d.modal.open(0,b.statusText)});c.setCallback(function(b){d.modal.close();0===b.error?(d.modal.open(1),f.options.master&&(f.options.master.calData.addToEventsPool([b.event]),f.options.master.layout.set())):d.modal.open(0,b.msg);a.find(".stec-builder-element-content-submit-style").show();"undefined"!==typeof window.grecaptcha&&(window.grecaptcha.reset(r),d.captcha.valid=!1)});m.query(c)}function t(){600>=a.width()?(a.removeClass("stec-media-med"),
a.addClass("stec-media-small")):870>=a.width()?(a.removeClass("stec-media-small"),a.addClass("stec-media-med")):a.removeClass("stec-media-med stec-media-small")}function x(){f.options.include_media_resize&&(c(window).on("resize stec-trigger-resize",function(){t()}),t());d.captcha.set();d.datePicker.set();d.colorPicker.set();d.repeater.init();d.guests.controller();d.attendance.controller();d.booking.controller();d.organizers.controller();d.schedules.controller();d.locations.controller();d.media.addImageController(".stec-builder-element-content-media-images-style",
{multiple:!0,inputName:"images[]"});d.media.addImageController(".stec-builder-element-content-media-icon-images-style",{multiple:!0,inputName:"icon_images[]"});d.media.addFileController(".stec-builder-element-content-attachments-style",{multiple:!0,inputName:"attachments[]"});c("body").on(h.clickHandle(),"#"+f.options.id+"-modal  button",function(){d.modal.close()});a.on("submit",function(b){b.preventDefault();a.find(".stec-builder-submission-organizer").remove();a.find(".stec-builder-submission-add-organizer").show();
w()});a.find('select[name="calendar_id"]').on("change",function(){var b=c(this).children().filter(":selected").data("color");a.find('input[name="event_color"]').css("background-color",b).val(b).ColorPickerSetColor(b)});a.find(".stec-builder-submission-add-image").on(h.clickHandle(),function(){a.find('input[name="stec_public_file_image"]').trigger("click")});a.find('input[name="stec_public_file_image"]').on("change",function(b){0<b.target.files.length?a.find(".stec-builder-submission-add-image-src").text(b.target.files[0].name):
a.find(".stec-builder-submission-add-image-src").text("")});a.find(".stec-builder-upload-attachments").on(h.clickHandle(),function(){a.find('input[name="stec_public_file_attachment"]').trigger("click")});a.find('input[name="stec_public_file_attachment"]').on("change",function(b){0<b.target.files.length?a.find(".stec-builder-submission-add-attachment-filename").text(b.target.files[0].name):a.find(".stec-builder-submission-add-attachment-filename").text("")});a.on("stec-day-change",function(b,c){f.options.day=
c.day;f.options.month=c.month;f.options.year=c.year;b=[f.options.year,f.options.month+1,f.options.day].join("-");b=window.moment(b,"YYYY-M-D");a.find('[name="start_date"]').datepicker("setDate",b.toDate());a.find('[name="end_date"]').datepicker("setDate",b.toDate());d.datePicker.generalTimeFix()});a.on(h.clickHandle(),'input[data-action="delete-event"]',function(){!0!==d.captcha.valid?d.modal.open(0,k("Verify Captcha")):d.modal.open(0,k("Are you sure"),function(){d.deleteEvent()})})}var m=null,h=
null,r=null,u="",a="",d=this,n=null,f={options:{}};this.captcha={valid:!1,set:function(){(0===parseInt(f.options.display_privacy_agreement,10)||0>=a.find(".stec-builder-element-content-privacy-style").children().length)&&a.find(".stec-builder-element-content-privacy-style").parent().remove();0===parseInt(f.options.captcha.enabled,10)||0>=a.find(".stec-builder-element-content-captcha-style").length?(a.find(".stec-builder-element-content-captcha-style").parent().remove(),d.captcha.valid=!0):this.load()},
load:function(){0>=a.find(".stec-builder-element-content-captcha-style div").children().length&&("undefined"===typeof window.grecaptcha.render?setTimeout(function(){d.captcha.load()},100):r=window.grecaptcha.render(a.find(".stec-builder-element-content-captcha-style div").get(0),{sitekey:f.options.captcha.site_key,callback:function(b){0!==b.length&&(d.captcha.valid=!0)}}))}};this.colorPicker={set:function(){c(".colorpicker-"+f.options.id).remove();a.find(".stec-builder-element-content-colorpicker-style").each(function(b){var a=
this,g=c(a).val();c(a).css({backgroundColor:g});c(a).StecColorPicker({klass:"colorpicker-"+f.options.id,id:"colorpicker-"+b+"-"+f.options.id,color:g,onShow:function(b){c(b).show();return!1},onHide:function(b){c(b).hide();return!1},onChange:function(b,e,g){c(a).attr("title","#"+e);c(a).css({backgroundColor:"#"+e});c(a).val("#"+e)}})})}};this.datePicker={set:function(){var b=[f.options.year,f.options.month+1,f.options.day].join("-"),e=window.moment(b,"YYYY-M-D");b=window.moment(b,"YYYY-M-D");var g=
window.moment();""!==a.find('[name="start_date"]').val()&&(e=window.moment(a.find('[name="start_date"]').val()));""!==a.find('[name="end_date"]').val()&&(b=window.moment(a.find('[name="end_date"]').val()));if(1===parseInt(f.options.create_event_form_allow_expired,10)||f.options.edit_event)g=null;a.find('[name="start_date"]').datepicker("destroy").datepicker({showAnim:0,minDate:g?g.toDate():null,dateFormat:n,altFormat:"yy-mm-dd",altField:h.getSelector(a,'[name="start_date_alt"]'),onSelect:function(){a.find('[name="end_date"]').datepicker("option",
"minDate",c(this).val());d.datePicker.generalTimeFix()}}).datepicker("setDate",e.toDate());a.find('[name="end_date"]').datepicker("destroy").datepicker({showAnim:0,minDate:g?g.toDate():null,dateFormat:n,altFormat:"yy-mm-dd",altField:h.getSelector(a,'[name="end_date_alt"]'),onSelect:function(){a.find('[name="start_date"]').datepicker("option","maxDate",c(this).val());d.datePicker.generalTimeFix()}}).datepicker("setDate",b.toDate());a.find('[name="repeat_ends_on_date"]').datepicker("destroy").datepicker({dateFormat:n,
altFormat:"yy-mm-dd",minDate:a.find('[name="end_date"]').val(),altField:h.getSelector(a,'[name="repeat_ends_on_date_alt"]')});a.find('[name="repeat_exdate_datepicker"]').datepicker("destroy").datepicker({dateFormat:n,altFormat:"yy-mm-dd",altField:h.getSelector(a,'[name="repeat_exdate_datepicker_alt"]')});a.find('[name="start_time_hours"],[name="end_time_hours"],[name="start_time_minutes"],[name="end_time_minutes"]').on("change",function(){d.datePicker.generalTimeFix()})},generalTimeFix:function(){var b=
a.find('[name="start_date"]'),c=a.find('[name="end_date"]'),g=a.find('[name="start_time_hours"]'),d=a.find('[name="end_time_hours"]'),f=a.find('[name="start_time_minutes"]'),h=a.find('[name="end_time_minutes"]');var l=new Date(b.val());l.setHours(g.val());l.setMinutes(f.val());var k=new Date(c.val());k.setHours(d.val());k.setMinutes(h.val());l.getTime()>k.getTime()&&(d.val(g.val()),h.val(f.val()));a.find('[name="repeat_ends_on_date"]').datepicker("option","minDate",c.val());a.find(".stec-builder-submission-schedule").find(".stec-builder-element-content-datetime-style").datepicker("option",
{minDate:b.val(),maxDate:c.val()})}};this.repeater={init:function(){this.template.exdate=c("#stec-repeater-content-exdate-datelist-template").html();this.controller()},template:{exdate:null},setRrule:function(){var b,e={};var g="";var d=[];if(!(0>=a.find('select[name="repeater"]').length)){g=a.find('select[name="repeater"]').val();var f=[];switch(g){case "0":g=!1;break;case "1":g=window.rrule.RRule.DAILY;break;case "2":g=window.rrule.RRule.WEEKLY;a.find(".stec-repeater-content-repeat-on").find('input[type="checkbox"]').filter(":checked").each(function(){f.push(window.rrule.RRule[c(this).attr("name")])});
break;case "3":g=window.rrule.RRule.MONTHLY;break;case "4":g=window.rrule.RRule.YEARLY}var h=a.find('select[name="repeat_gap"]').val();var l=b=!1;switch(a.find('input[name="repeat_endson"]').filter(":checked").val()){case "0":l=b=!1;break;case "1":b=a.find('input[name="repeat_occurences"]').val();l=!1;break;case "2":b=!1,l=new Date(a.find('input[name="repeat_ends_on_date_alt"]').val())}e.freq=g;0<b&&(e.count=b);l&&(e.until=l);0<h&&(e.interval=h);0<f.length&&(e.byweekday=f);g=!1!==g?new window.rrule.RRule(e):
new window.rrule.RRule;e=g.toString();a.find('input[name="rrule"]').val(e);a.find(".stec-repeater-content-exdate-datelist").children().each(function(){d.push(c(this).data("exdate"))});a.find('input[name="exdate"]').val(d.join(","))}},addExdate:function(b){var e=!1;a.find(".stec-repeater-content-exdate-datelist").children().each(function(){if(c(this).data("exdate")===b.format("YYYYMMDD"))return e=!0,!1});if(!0!==e){var g=c(this.template.exdate).clone().html(function(a,c){return c.replace("stec_replace_date",
q(b))});c(g).data("exdate",b.format("YYYYMMDD")).appendTo(a.find(".stec-repeater-content-exdate-datelist"))}},controller:function(){a.find('input[name="all_day"]').on("change",function(){c(this).is(":checked")?a.find('select[name="start_time_hours"], select[name="end_time_hours"], select[name="start_time_minutes"], select[name="end_time_minutes"]').val("00").css("opacity",.5).prop("disabled",!0):a.find('select[name="start_time_hours"], select[name="end_time_hours"], select[name="start_time_minutes"], select[name="end_time_minutes"]').css("opacity",
1).prop("disabled",!1)});a.find(".stec-repeater-content-exdate-datelist").on(h.clickHandle(),".stec-remove-exdate",function(){c(this).parents("li").first().remove()});a.find(".stec-repeater-content-add-exdate-button").on(h.clickHandle(),function(){var b=p(a.find('[name="repeat_exdate_datepicker_alt"]').val(),"YYYY-MM-DD");!0===b.isValid()&&d.repeater.addExdate(b)});a.find('input[name="repeat_endson"]').on("change",function(){switch(parseInt(c(this).val(),10)){case 0:a.find('input[name="repeat_occurences"]').prop("disabled",
!0);a.find('input[name="repeat_ends_on_date"]').prop("disabled",!0);break;case 1:a.find('input[name="repeat_occurences"]').prop("disabled",!1);a.find('input[name="repeat_ends_on_date"]').prop("disabled",!0);break;case 2:a.find('input[name="repeat_occurences"]').prop("disabled",!0),a.find('input[name="repeat_ends_on_date"]').prop("disabled",!1)}});a.find('select[name="repeater"]').on("change",function(){switch(parseInt(c(this).val(),10)){case 0:a.find(".stec-repeater-content").hide();a.find(".stec-repeater-content-weekdays").hide();
break;case 2:a.find(".stec-repeater-content").show();a.find(".stec-repeater-content-weekdays").show();break;default:a.find(".stec-repeater-content").show(),a.find(".stec-repeater-content-weekdays").hide()}})}};this.organizers={template:null,blockAction:!1,init:function(){0>=a.find(".stec-builder-element-content-organizers-style").length||(this.template=c("#stec-builder-submission-organizer-template").html())},arrangeSocLinks:function(b){b.find(".stec-builder-submission-organizer-social").each(function(b){c(this).find("input, select").each(function(){this.name=
this.name.replace(/social\[\d\]/g,function(a,c){return"social["+b+"]"})})})},validateFields:function(){var b=!0;a.find(".stec-builder-submission-organizer").find('input[name="name"]').val().trim()||(b=!1);return b},insertNewOrganizer:function(){if(!1!==this.validateFields()&&!0!==this.blockAction){var b=a.find(".stec-builder-submission-organizer");var e=new FormData;b.find("input,select,textarea").each(function(){e.append(c(this).attr("name"),c(this).val())});e.append("action","stec_public_ajax_action");
e.append("task","insert_new_organizer");var g=m.newRequest();g.setData(e);g.setBefore(function(){d.organizers.blockAction=!0;b.find(".status").find("p").text(b.find(".status").data("default-text"));b.find(".status").show();b.find('[data-action="insert-organizer"]').hide()});g.setOnError(function(b){d.organizers.blockAction=!1});g.setCallback(function(e){d.organizers.blockAction=!1;b.find(".status").hide();b.find('[data-action="insert-organizer"]').show();if(e.error)b.find(".status").find("p").text(e.error_msg),
b.find(".status").show();else if(e.data.success&&e.data.organizer){var g=a.find('select[name="organizers[]"]');e='<option selected value="'+e.data.organizer.id+'">'+e.data.organizer.name+"</option>";c(e).appendTo(g);g.focus();b.find(".delete").trigger(h.clickHandle())}});m.query(g)}},controller:function(){d.media.addImageController(".stec-builder-submission-organizer",{multiple:!1,inputName:"photo",callback:function(){}});a.find(".stec-builder-element-content-organizers-style").on(h.clickHandle(),
".stec-builder-submission-organizer-head button.collapse",function(){c(this).parents(".stec-builder-submission-organizer").first().addClass("collapsed")});a.find(".stec-builder-element-content-organizers-style").on(h.clickHandle(),".stec-builder-submission-organizer-head button.expand",function(){c(this).parents(".stec-builder-submission-organizer").first().removeClass("collapsed")});a.find(".stec-builder-element-content-organizers-style").on(h.clickHandle(),".stec-builder-submission-organizer-head button.delete",
function(){c(this).parents(".stec-builder-submission-organizer").first().remove();a.find(".stec-builder-submission-add-organizer").show()});a.find(".stec-builder-submission-add-organizer").on(h.clickHandle(),function(){c(d.organizers.template).insertBefore(this);c(this).hide()});a.find(".stec-builder-element-content-organizers-style").on(h.clickHandle(),".add-organizers-soclink",function(){var b=c(this).parents(".stec-builder-submission-organizer").first(),a=b.find(".stec-builder-submission-organizer-social").first().clone()[0].outerHTML;
c(a).insertBefore(b.find(".add-organizers-soclink")).find("select, input").val(null);d.organizers.arrangeSocLinks(b)});a.find(".stec-builder-element-content-organizers-style").on(h.clickHandle(),".stec-builder-submission-organizer-social-remove",function(){var b=c(this).parents(".stec-builder-submission-organizer").first(),a=c(this).parents(".stec-builder-submission-organizer-social").first();1>=b.find(".stec-builder-submission-organizer-social").length?a.find("select, input").val(null):a.remove();
d.organizers.arrangeSocLinks(b)});a.on(h.clickHandle(),'.stec-builder-submission-organizer [data-action="insert-organizer"]',function(){d.organizers.insertNewOrganizer()})}};this.guests={template:null,init:function(){0>=a.find(".stec-builder-element-content-guests-style").length||(this.template=c("#stec-builder-submission-guest-template").html())},arrangeGuests:function(){a.find(".stec-builder-submission-guest").each(function(b){c(this).find("input, select, textarea").each(function(){this.name=this.name.replace(/guests\[\d]/g,
function(a,c){return"guests["+b+"]"})});c(this).find("[data-name]").each(function(){c(this).attr("data-name",c(this).attr("data-name").replace(/guests\[\d]/g,function(a,c){return"guests["+b+"]"}))})})},arrangeSocLinks:function(b){b.find(".stec-builder-submission-guest-social").each(function(b){c(this).find("input, select").each(function(){this.name=this.name.replace(/\[social]\[\d]/g,function(a,c){return"[social]["+b+"]"})})})},addGuest:function(b){var e=c(this.template).addClass("collapsed").insertBefore(a.find(".stec-builder-submission-add-guest"));
e.find("input[name^='guests['][name$='[name]']").val(b.name);e.find("textarea[name^='guests['][name$='[about]']").val(b.about);b.photo&&d.media.fillImage(e.get(0),{inputName:"guests[0][photo]",image:{id:b.photo,src:b.photo_full}});0<b.links.length&&(c.each(b.links,function(){if(""!==this.link){var b=e.find(".stec-builder-submission-guest-social").first().clone()[0].outerHTML;b=c(b).insertBefore(e.find(".add-guests-soclink"));b.find("select").val(this.ico);b.find("input").val(this.link);d.guests.arrangeSocLinks(e)}}),
e.find(".stec-builder-submission-guest-social").first().remove());this.arrangeGuests()},controller:function(){d.media.addImageController(".stec-builder-submission-guest",{multiple:!1,inputName:"guests[0][photo]",callback:function(){d.guests.arrangeGuests()}});a.find(".stec-builder-element-content-guests-style").on(h.clickHandle(),".stec-builder-submission-guest-head button.collapse",function(){c(this).parents(".stec-builder-submission-guest").first().addClass("collapsed")});a.find(".stec-builder-element-content-guests-style").on(h.clickHandle(),
".stec-builder-submission-guest-head button.expand",function(){c(this).parents(".stec-builder-submission-guest").first().removeClass("collapsed")});a.find(".stec-builder-element-content-guests-style").on(h.clickHandle(),".stec-builder-submission-guest-head button.delete",function(){c(this).parents(".stec-builder-submission-guest").first().remove();d.guests.arrangeGuests()});a.find(".stec-builder-submission-add-guest").on(h.clickHandle(),function(){c(d.guests.template).insertBefore(this);d.guests.arrangeGuests()});
a.find(".stec-builder-element-content-guests-style").on(h.clickHandle(),".add-guests-soclink",function(){var b=c(this).parents(".stec-builder-submission-guest").first(),a=b.find(".stec-builder-submission-guest-social").first().clone()[0].outerHTML;c(a).insertBefore(b.find(".add-guests-soclink")).find("select, input").val(null);d.guests.arrangeSocLinks(b)});a.find(".stec-builder-element-content-guests-style").on(h.clickHandle(),".stec-builder-submission-guest-social-remove",function(){var b=c(this).parents(".stec-builder-submission-guest").first(),
a=c(this).parents(".stec-builder-submission-guest-social").first();1>=b.find(".stec-builder-submission-guest-social").length?a.find("select, input").val(null):a.remove();d.guests.arrangeSocLinks(b)})}};this.attendance={template:null,init:function(){0>=a.find(".stec-builder-element-content-attendance-style").length||(this.template=c("#stec-builder-submission-attendance-template").html())},arrangeAttendees:function(){a.find(".stec-builder-submission-attendance").each(function(b){c(this).find("input, select, textarea").each(function(){this.name=
this.name.replace(/attendees\[\d]/g,function(a,c){return"attendees["+b+"]"})});c(this).find("[data-name]").each(function(){c(this).attr("data-name",c(this).attr("data-name").replace(/attendees\[\d]/g,function(a,c){return"attendees["+b+"]"}))})})},addAttendee:function(b){var e=c(this.template).insertBefore(a.find(".stec-builder-submission-add-attendee"));e.find("input[name^='attendees['][name$='[email]']").val(b.email);e.find("input[name^='attendees['][name$='[people]']").val(b.people);e.find("input[name^='attendees['][name$='[send_email]']").prop("checked",
b.mail_sent?!1:!0);this.arrangeAttendees()},controller:function(){a.find(".stec-builder-element-content-attendance-style").on(h.clickHandle(),".stec-builder-submission-attendee-head button.collapse",function(){c(this).parents(".stec-builder-submission-attendance").first().addClass("collapsed")});a.find(".stec-builder-element-content-attendance-style").on(h.clickHandle(),".stec-builder-submission-attendee-head button.expand",function(){c(this).parents(".stec-builder-submission-attendance").first().removeClass("collapsed")});
a.find(".stec-builder-element-content-attendance-style").on(h.clickHandle(),".stec-builder-submission-attendee-head button.delete",function(){c(this).parents(".stec-builder-submission-attendance").first().remove();d.attendance.arrangeAttendees()});a.find(".stec-builder-submission-add-attendee").on(h.clickHandle(),function(){c(d.attendance.template).insertBefore(this);d.attendance.arrangeAttendees()})}};this.schedules={template:null,init:function(){0>=a.find(".stec-builder-element-content-schedules-style").length||
(this.template=c("#stec-builder-submission-schedule-template").html())},arrangeSchedules:function(){a.find(".stec-builder-submission-schedule").each(function(b){c(this).find("input, select, textarea").each(function(){this.name=this.name.replace(/schedule\[\d]/g,function(a,c){return"schedule["+b+"]"})});c(this).find("[data-name]").each(function(){c(this).attr("data-name",c(this).attr("data-name").replace(/schedule\[\d]/g,function(a,c){return"schedules["+b+"]"}))})})},addSchedule:function(b){var e=
c(this.template).addClass("collapsed").insertBefore(a.find(".stec-builder-submission-add-schedule"));this.arrangeSchedules();e.find("input[name^='schedule['][name$='[schedule_title]']").val(b.title);e.find("textarea[name^='schedule['][name$='[schedule_details]']").val(b.details);var d=b.start_date.split(" ");var f=d[1].split(":");e.find(".stec-builder-element-content-datetime-style").first().val(q(d[0]));e.find('[name$="[schedule_time_hours_from]"]').val(f[0]);e.find('[name$="[schedule_time_minutes_from]"]').val(f[1]);
e.find(".stec-builder-element-content-colorpicker-style").val(b.icon_color);e.find('[name$="[schedule_icon]"]').val(b.icon);this.addDatePicker(e);this.addColorPicker(e)},addDatePicker:function(b){var c=new Date(f.options.year,f.options.month,f.options.day);""!==b.find(".stec-builder-element-content-datetime-style").first().val()&&(c=b.find(".stec-builder-element-content-datetime-style").first().val());b.find(".stec-builder-element-content-datetime-style").first().datepicker("destroy").datepicker({setDate:f.options.year+
"-"+f.options.month+"-"+f.options.day,showAnim:0,minDate:a.find('[name="start_date"]').val(),maxDate:a.find('[name="end_date"]').val(),dateFormat:n,altFormat:"yy-mm-dd",altField:b.find(".stec-builder-element-content-datetime-style").first().next(),onSelect:function(){}}).datepicker("setDate",c)},addColorPicker:function(b){b.find(".stec-builder-element-content-colorpicker-style").each(function(b){var a=this,e=c(a).val();0<c("#colorpicker-schedule-"+b+"-"+f.options.id).length&&c("#colorpicker-schedule-"+
b+"-"+f.options.id).remove();c(a).css({backgroundColor:e});c(a).StecColorPicker({klass:"colorpicker-schedule-"+f.options.id,id:"colorpicker-schedule-"+b+"-"+f.options.id,color:e,onShow:function(b){c(b).show();return!1},onHide:function(b){c(b).hide();return!1},onChange:function(b,e,d){c(a).attr("title","#"+e);c(a).css({backgroundColor:"#"+e});c(a).val("#"+e)}})})},controller:function(){a.find(".stec-builder-element-content-schedules-style").on(h.clickHandle(),".stec-builder-submission-schedule-head button.collapse",
function(){c(this).parents(".stec-builder-submission-schedule").first().addClass("collapsed")});a.find(".stec-builder-element-content-schedules-style").on(h.clickHandle(),".stec-builder-submission-schedule-head button.expand",function(){c(this).parents(".stec-builder-submission-schedule").first().removeClass("collapsed")});a.find(".stec-builder-element-content-schedules-style").on(h.clickHandle(),".stec-builder-submission-schedule-head button.delete",function(){c(this).parents(".stec-builder-submission-schedule").first().remove();
d.schedules.arrangeSchedules()});a.find(".stec-builder-submission-add-schedule").on(h.clickHandle(),function(){var b=c(d.schedules.template).insertBefore(this);d.schedules.addDatePicker(b);d.schedules.addColorPicker(b);d.schedules.arrangeSchedules()})}};this.locations={init:function(){this.checkState();this.checkLocationType()},checkLocationType:function(){switch(a.find('select[name="location_type"]').val()){case "physical":a.find(".stec-builder-submission-new-location-physical-data").show();break;
case "virtual":a.find(".stec-builder-submission-new-location-physical-data").hide()}},checkCountryState:function(){var b=a.find(".stec-builder-submission-new-address"),c=b.find('select[name="location_city"]');b=b.find('select[name="location_country"]').val();c.children().not(":disabled").hide();c.children().filter('[data-country="'+b+'"]').show();c.val(c.children().first().val())},checkState:function(){switch(a.find('.stec-builder-element-content-select-style[name="location"]').val()){case "custom_address":a.find(".stec-builder-submission-new-address").show();
a.find(".stec-builder-submission-new-location").hide();this.checkCountryState();break;case "custom":a.find(".stec-builder-submission-new-address").hide();a.find(".stec-builder-submission-new-location").show();break;default:a.find(".stec-builder-submission-new-location").hide(),a.find(".stec-builder-submission-new-address").hide()}},nominatimGetCoordinates:function(b){return new Promise(function(a,d){c.getJSON("//nominatim.openstreetmap.org/search?format=json&limit=1&q="+b,function(c){return 0<c.length?
a([c[0].lat,c[0].lon].join()):d(b)})})},googleGetCoordinates:function(b){return new Promise(function(a,c){(new window.google.maps.Geocoder).geocode({address:b},function(e,d){return d===window.google.maps.GeocoderStatus.OK?(e=e[0].geometry.location.toString().replace(/\(|\)/gi,""),a(e)):c(b)})})},fillCoordinates:function(){var b=a.find(".stec-builder-submission-new-address, .stec-builder-submission-new-location"),c=b.find('[name="location_address"]').val(),d=b.find('[name="location_city"]').val(),
f=b.find('[name="location_country"]').val();c=(c+" "+d+" "+f).trim();if(!c)return!1;"object"===typeof window.google&&"object"===typeof window.google.maps?this.googleGetCoordinates(c).then(function(a){b.find(".stec-builder-element-content-coordinates-wrap input").val(a);h.toast(k("Coordinates added"),"body")}).catch(function(b){h.toast(k("Unable to obtain coordinates for this location"))}):this.nominatimGetCoordinates(c).then(function(a){b.find(".stec-builder-element-content-coordinates-wrap input").val(a);
h.toast(k("Coordinates added"),"body")}).catch(function(b){h.toast(k("Unable to obtain coordinates for this location"))})},controller:function(){a.find('select[name="location_type"]').on("change",function(){d.locations.checkLocationType()});a.find('.stec-builder-element-content-select-style[name="location"]').on("change",function(){d.locations.checkState()});a.find('.stec-builder-submission-new-address select[name="location_country"]').on("change",function(){d.locations.checkCountryState()});a.find(".stec-builder-element-content-coordinates-wrap button").on(h.clickHandle(),
function(){d.locations.fillCoordinates()})}};this.booking={template:null,init:function(){this.template=c("#stec-builder-submission-ticket-template").html()},arrangeTickets:function(){a.find(".stec-builder-submission-ticket").each(function(b){c(this).find("input, select, textarea").each(function(){this.name=this.name.replace(/tickets\[\d]/g,function(a,c){return"tickets["+b+"]"})});c(this).find("[data-name]").each(function(){c(this).attr("data-name",c(this).attr("data-name").replace(/tickets\[\d]/g,
function(a,c){return"tickets["+b+"]"}))})})},arrangeAttributes:function(b){b.find(".stec-builder-submission-ticket-attributes").each(function(b){c(this).find("input").each(function(){this.name=this.name.replace(/\[attr]\[\d]/g,function(a,c){return"[attr]["+b+"]"})})})},addTicket:function(b){var e="hours",g=c(this.template).addClass("collapsed").insertBefore(a.find(".stec-builder-submission-add-ticket"));g.find("input[name^='tickets['][name$='[id]']").val(b.id?parseInt(b.id,10):0);g.find("input[name^='tickets['][name$='[name]']").val(b.title);
g.find("input[name^='tickets['][name$='[price]']").val(b.price);g.find("input[name^='tickets['][name$='[qty]']").val(b.stock_quantity);g.find("input[name^='tickets['][name$='[qty_per_event]']").val(b.qty_limit_per_event);g.find("textarea[name^='tickets['][name$='[about]']").val(b.short_description);var f=parseInt(b.stop_before,10);isNaN(f)&&(f=0);0<f&&(f/=3600,0===f%24&&(e="days",f/=24),g.find("select[name^='tickets['][name$='[wc_book_create_ticket_stop_purchase][units]']").val(e),g.find("input[name^='tickets['][name$='[wc_book_create_ticket_stop_purchase][value]']").val(f));
0<b.attributes.length&&(c.each(b.attributes,function(){if(""!==this.name){var b=g.find(".stec-builder-submission-ticket-attributes").first().clone()[0].outerHTML;b=c(b).insertBefore(g.find(".stec-builder-submission-ticket-attributes").first());b.find('input[name$="[attr_name]"]').first().val(this.name);b.find('input[name$="[attr_value]"]').first().val(this.value);d.booking.arrangeAttributes(g)}}),g.find(".stec-builder-submission-ticket-social").first().remove());this.arrangeTickets()},controller:function(){a.find(".stec-builder-element-content-booking-style").on(h.clickHandle(),
".stec-builder-submission-ticket-head button.collapse",function(){c(this).parents(".stec-builder-submission-ticket").first().addClass("collapsed")});a.find(".stec-builder-element-content-booking-style").on(h.clickHandle(),".stec-builder-submission-ticket-head button.expand",function(){c(this).parents(".stec-builder-submission-ticket").first().removeClass("collapsed")});a.find(".stec-builder-element-content-booking-style").on(h.clickHandle(),".stec-builder-submission-ticket-head button.delete",function(){c(this).parents(".stec-builder-submission-ticket").first().remove();
d.booking.arrangeTickets()});a.find(".stec-builder-submission-add-ticket").on(h.clickHandle(),function(){c(d.booking.template).insertBefore(this);d.booking.arrangeTickets()});a.find(".stec-builder-element-content-booking-style").on(h.clickHandle(),".add-ticket-attribute",function(){var b=c(this).parents(".stec-builder-submission-ticket").first(),a=b.find(".stec-builder-submission-ticket-attributes").first().clone()[0].outerHTML;c(a).insertAfter(b.find(".stec-builder-submission-ticket-attributes").last()).find("input").val(null);
d.booking.arrangeAttributes(b)});a.find(".stec-builder-element-content-booking-style").on(h.clickHandle(),".stec-builder-submission-ticket-attrib-remove",function(){var b=c(this).parents(".stec-builder-submission-ticket").first(),a=c(this).parents(".stec-builder-submission-ticket-attributes").first();1>=b.find(".stec-builder-submission-ticket-attributes").length?a.find("input").val(null):a.remove();d.booking.arrangeAttributes(b)})}};this.modal={html:function(b,a,c){var e=[f.options.id,"modal"].join("-");
switch(b){case 2:var d="far fa-clock";var g="stec-wait";break;case 0:g="stec-error";d="far fa-frown";a||(a=k("submitError"));break;default:g="stec-success",d="far fa-smile",a||(a=k("submitSuccess"))}var h=[];h.push('<div id="'+e+'" class="stec-builder-form-modal stec-modal '+g+'">');h.push('   <div class="stec-builder-form-modal-block">');h.push('           <div class="stec-builder-form-modal-block-top">');h.push("               <div>");h.push('                   <i class="'+d+'"></i>');h.push("               </div>");
h.push("           </div>");h.push('           <div class="stec-builder-form-modal-wrap">');h.push("               <p>"+a+"</p>");c?(h.push('               <button data-action="confirm" class="stec-style-button">Yes</button>'),h.push('               <button class="stec-style-button">No</button>')):h.push('               <button class="stec-style-button">'+(2===b?k("close"):k("ok"))+"</button>");h.push("           </div>");h.push("   </div>");h.push("</div>");return h.join("")},close:function(){c("body").removeClass("stec-modal-opened");
c("#"+f.options.id+"-modal").remove()},open:function(b,a,d){c("body").addClass("stec-modal-opened");c(this.html(b,a,d)).appendTo("body");if("function"===typeof d)c("#"+f.options.id+"-modal").find('[data-action="confirm"]').one(h.clickHandle(),function(){d()})}};this.media={limit:10,init:function(){this.controller()},fillImage:function(b,a){if(!0===a.multiple&&c(b).find(".stec-builder-media-photo").length>=d.media.limit)c(b).find(".stec-builder-add-media-photo").hide();else{var e=[];e.push('<div class="stec-builder-media-photo">');
e.push('   <i class="fa fa-times"></i>');e.push('   <img data-id="'+a.image.id+'" src="'+a.image.src+'" />');e.push('   <input type="hidden" name="'+a.inputName+'" value="'+a.image.id+'">');e.push("</div>");c(e.join("")).insertBefore(c(b).find(".stec-builder-add-media-photo"));(!0!==a.multiple||c(b).find(".stec-builder-media-photo").length>=d.media.limit)&&c(b).find(".stec-builder-add-media-photo").hide();"function"===typeof a.callback&&a.callback()}},fillAttachment:function(a,e){if(!0===e.multiple&&
c(a).find(".stec-builder-media-attachment").length>=d.media.limit)c(a).find(".stec-builder-add-media-attachments").hide();else{var b=[];b.push('<div class="stec-builder-media-attachment">');b.push('   <span class="stec-builder-element-content-p-style">'+e.file.title+"</span>");b.push('   <i class="fa fa-times"></i>');b.push('   <input type="hidden" name="'+e.inputName+'" value="'+e.file.id+'">');b.push("</div>");c(b.join("")).insertBefore(c(a).find(".stec-builder-add-media-attachments"));(!0!==e.multiple||
c(a).find(".stec-builder-media-attachment").length>=d.media.limit)&&c(a).find(".stec-builder-add-media-attachments").hide();"function"===typeof e.callback&&e.callback()}},addFileController:function(b,e){a.on("click",b+" .stec-builder-add-media-attachments",function(a){var f=this;a.preventDefault();var g=window.wp.media({library:{},multiple:e.multiple});g.open();g.on("select",function(){var a=g.state().get("selection").toJSON();c(a).each(function(a){a=[];a.push('<div class="stec-builder-media-attachment">');
a.push('   <span class="stec-builder-element-content-p-style">'+this.title+"</span>");a.push('   <i class="fa fa-times"></i>');a.push('   <input type="hidden" name="'+e.inputName+'" value="'+this.id+'">');a.push("</div>");c(a.join("")).insertBefore(f);(!0!==e.multiple||c(b).find(".stec-builder-media-attachment").length>=d.media.limit)&&c(b).find(".stec-builder-add-media-attachments").hide()});0<a.length&&"function"===typeof e.callback&&e.callback()})});a.on("click",b+" .stec-builder-media-attachment i",
function(){var a=c(this).parents(b).first();c(this).parents(".stec-builder-media-attachment").first().remove();a.find(".stec-builder-add-media-attachments").show()})},addImageController:function(b,e){a.on("click",b+" .stec-builder-add-media-photo",function(a){var f=this;a.preventDefault();var g=window.wp.media({library:{type:["image"]},multiple:e.multiple});g.open();g.on("select",function(){var a=g.state().get("selection").toJSON();c(a).each(function(a){if("image"===this.type)if(!0===e.multiple&&
c(b).find(".stec-builder-media-photo").length>=d.media.limit)c(f).hide();else{a=this.sizes.medium?this.sizes.medium.url:this.sizes.full.url;var g=[];g.push('<div class="stec-builder-media-photo">');g.push('   <i class="fa fa-times"></i>');g.push('   <img data-id="'+this.id+'" src="'+a+'" alt="'+this.alt+'" />');g.push('   <input type="hidden" name="'+e.inputName+'" value="'+this.id+'">');g.push("</div>");c(g.join("")).insertBefore(f);(!0!==e.multiple||c(b).find(".stec-builder-media-photo").length>=
d.media.limit)&&c(b).find(".stec-builder-add-media-photo").hide()}});0<a.length&&"function"===typeof e.callback&&e.callback()})});a.on("click",b+" .stec-builder-media-photo i",function(){var a=c(this).parents(b).first();c(this).parents(".stec-builder-media-photo").first().remove();a.find(".stec-builder-add-media-photo").show()})},controller:function(){}};this.tinymce={id:null,$editor:null,init:function(){var b=this,c={};try{this.id="stec-editor-id-"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,
15);var d=a.find('textarea[name="description"]').attr("id",this.id);c={init_instance_callback:function(a){b.$editor=a},setup:function(a){a.on("change",function(){d.get(0).value=a.getContent()})},wpautop:!0,resize:!1,height:d.height()-110,toolbar1:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | table | fontsizeselect | forecolor backcolor | preview fullscreen"};window.wp.editor.initialize(this.id,{tinymce:c,quicktags:!0})}catch(y){this.$editor=
this.id=null}},getContent:function(){try{return window.tinymce.editors[this.id].getContent()}catch(b){return a.find('textarea[name="description"]').val()}},setContent:function(b){try{this.$editor.setContent(b)}catch(e){a.find('textarea[name="description"]').val(b)}}};this.iconTypes={init:function(){0>=a.find('select[name="icon_type"]').length||(this.controller(),this.set())},set:function(){switch(a.find('select[name="icon_type"]').val()){case "image":a.find(".stec-builder-element-content-media-icon-images-style").show();
a.find('select[name="icon"]').hide();break;case "date":a.find('select[name="icon"]').hide();a.find(".stec-builder-element-content-media-icon-images-style").hide();break;default:a.find('select[name="icon"]').show(),a.find(".stec-builder-element-content-media-icon-images-style").hide()}},controller:function(){a.find('select[name="icon_type"]').on("change",function(){d.iconTypes.set()})}};this.deleteEvent=function(){var b=f.options.edit_event.id;var c=m.newRequest();c.setData({action:"stec_public_ajax_action",
"g-recaptcha-response":a.find(".g-recaptcha-response").val(),task:"front_delete_event",id:b});c.setBefore(function(){d.modal.close();d.modal.open(2,k("deleting"))});c.setOnError(function(a){});c.setCallback(function(a){d.modal.close();a?1===a.error?d.modal.open(0,a.msg):d.modal.open(1,a.msg):d.modal.open(0,k("submitError"));"undefined"!==typeof window.grecaptcha&&(d.captcha.valid=!1,window.grecaptcha.reset(r))});m.query(c)};this.init=function(b){var e=new Date;c.extend(f.options,b);u="#"+f.options.id;
a=c(u);m=new window.StecDB;h=new window.StecHelper;f.options.master?(f.options.day=f.options.master.glob.options.day,f.options.month=f.options.master.glob.options.month,f.options.year=f.options.master.glob.options.year):(f.options.day=e.getDate(),f.options.month=e.getMonth(),f.options.year=e.getFullYear());switch(f.options.date_format){case "dd.mm.yyyy":n="dd.mm.yy";break;default:n=f.options.date_format}if(f.options.cal){var g=c.map(f.options.cal.split(","),function(a){return parseInt(a,10)});a.find('select[name="calendar_id"]').children().each(function(){-1===
c.inArray(parseInt(c(this).val(),10),g)&&c(this).remove()})}if(f.options.cat){var k=c.map(f.options.cat.split(","),function(a){return parseInt(a,10)});a.find('select[name="event_categories[]"]').children().each(function(){-1===c.inArray(parseInt(c(this).val(),10),k)&&c(this).remove()})}d.guests.init();d.attendance.init();d.organizers.init();d.locations.init();d.booking.init();d.schedules.init();d.media.init();d.tinymce.init();d.iconTypes.init();x();f.options.edit_event?v():a.find('input[name="contact_email"]').val(f.options.useremail)}}
var k=(new window.StecHelper).lang,p=window.moment;p.locale("en");c(function(){"undefined"!==window.stecSubmitFormInstance&&c.each(window.stecSubmitFormInstance,function(){(new q).init(this)})});window.stecEventSubmissionForm=q})(window.jQuery);